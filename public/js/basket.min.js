function attachBehaviour(){attachRefreshOrder(),attachClearOrder(),attachConfirmOrder(),attachDeleteOrder(),attachDeleteOrderItem(),attachQuantityChange(),attachNewOrder()}function removeBehaviour(){detachRefreshOrder(),detachClearOrder(),detachDeleteOrder(),detachConfirmOrder(),detachDeleteOrderItem(),detachQuantityChange(),detachNewOrder()}function attachRefreshOrder(){$refreshOrder.click(function(t){t.preventDefault(),t.stopPropagation(),$items.length&&updateOrder()})}function detachRefreshOrder(){$refreshOrder.off("click")}function attachConfirmOrder(){$confirmOrder.click(function(t){t.preventDefault(),t.stopPropagation(),$items.length&&updateOrder(function(t){confirmOrder(function(t){window.location.href=urlToRoute("invoice",t)})})})}function detachConfirmOrder(){$confirmOrder.off("click")}function attachClearOrder(){$clearOrder.click(function(t){t.preventDefault(),t.stopPropagation(),$items.length&&(orderItems={},updateOrder())})}function detachClearOrder(){$clearOrder.off("click")}function attachDeleteOrder(){$deleteOrder.click(function(t){t.preventDefault(),t.stopPropagation(),$.ajax({url:urlToRoute("order.destroy",$order[0].dataset.id),type:"POST",data:{_token:csrfToken,_method:"DELETE"},dataType:"JSON",beforeSend:function(){$ajaxLoader.fadeIn()}}).always(function(){$ajaxLoader.fadeOut()}).done(function(t,e,a){"success"==t.status&&(window.location.href=window.location.origin+window.location.pathname)})})}function detachDeleteOrder(){$deleteOrder.off("click")}function attachDeleteOrderItem(){$order.on("click",".delete-item",function(t){t.preventDefault(),t.stopPropagation();var e=t.target.parentNode.dataset.id;delete orderItems[e],updateOrder()})}function detachDeleteOrderItem(){$order.off(".delete-item")}function attachNewOrder(){$newOrder.click(function(t){t.preventDefault(),t.stopPropagation(),$.ajax({url:urlToRoute("order.open"),type:"POST",data:{_token:csrfToken},dataType:"JSON",beforeSend:function(){$ajaxLoader.fadeIn()}}).always(function(){$ajaxLoader.fadeOut()}).done(function(t,e,a){"success"==t.status?buildOrder(t.order):$basket.find(".panel-body").html(t.message)})})}function detachNewOrder(){$newOrder.off("click")}function attachQuantityChange(){$order.on("change","select",function(t){t.preventDefault(),t.stopPropagation(),orderItems[t.currentTarget.dataset.id]=t.currentTarget.value,updateOrder()})}function detachQuantityChange(){$order.off("change","select")}function buildOrder(t){var e='<div class="order-data">\t\t\t\t\t<table class="order table table-bord-ered table-condensed table-hover" data-id="'+t.id+'">\t\t\t\t\t\t<thead>\t\t\t\t\t\t\t<tr>\t\t\t\t\t\t\t\t<th class="text-center">#</th>\t\t\t\t\t\t\t\t<th class="text-center">name</th>\t\t\t\t\t\t\t\t<th class="text-center">quantity</th>\t\t\t\t\t\t\t\t<th class="text-center">net price <span class="label label-info">L.E.</span></th>\t\t\t\t\t\t\t\t<th class="text-center">remove</th>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t</thead>\t\t\t\t\t\t<tbody>\t\t\t\t\t\t\t\t\t\t\t\t\t</tbody>\t\t\t\t\t\t<tfoot>\t\t\t\t\t\t\t<tr class="active total success">\t\t\t\t\t\t\t\t<th class="text-center" colspan=2>Total</th>\t\t\t\t\t\t\t\t<th class="text-center quantity">0</th>\t\t\t\t\t\t\t\t<th class="text-center net-price">0</th>\t\t\t\t\t\t\t\t<th class="text-center"></th>\t\t\t\t\t\t\t</tr>\t\t\t\t\t\t</tfoot>\t\t\t\t\t</table>\t\t\t\t</div>',a='<div class="panel-footer">\t\t\t\t\t<div class="row">\t\t\t\t\t\t<div class="col-xs-3">\t\t\t\t\t\t\t<a href="#" class="btn btn-danger btn-xs btn-block delete-order">Delete</a>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="col-xs-3">\t\t\t\t\t\t\t<a href="#" class="btn btn-warning btn-xs btn-block clear-order">clear</a>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="col-xs-3">\t\t\t\t\t\t\t<a href="#" class="btn btn-success btn-xs btn-block confirm-order">Confirm</a>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="col-xs-3">\t\t\t\t\t\t\t<a href="#" class="btn btn-primary btn-xs btn-block refresh-order">Refresh</a>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t </div>';$basket.append(a).find(".panel-heading").after(e).end().find(".panel-body").remove(),$order=$basket.find(".order"),$items=$order.find("tr[data-id]"),$total=$order.find("tr.total"),orderItems={},$confirmOrder=$basket.find(".confirm-order"),$deleteOrder=$basket.find(".delete-order"),$refreshOrder=$basket.find(".refresh-order"),$clearOrder=$basket.find(".clear-order"),attachBehaviour()}function updateOrder(t){$.ajax({url:urlToRoute("order.update"),type:"POST",data:{_token:csrfToken,_method:"PUT",items:orderItems},dataType:"JSON",beforeSend:function(){$ajaxLoader.fadeIn()}}).always(function(){$ajaxLoader.fadeOut()}).done(function(e,a,r){"success"==e.status&&(orderItems=e.data,sync(e,t))})}function confirmOrder(t){$.ajax({url:urlToRoute("order.confirm"),type:"POST",data:{_token:csrfToken},dataType:"JSON",beforeSend:function(){$ajaxLoader.fadeIn()}}).always(function(){$ajaxLoader.fadeOut()}).done(function(e,a,r){"success"==e.status&&"function"==typeof t&&t.call(this,e.invoice_id)})}function sync(t,e){var a=!1;detachQuantityChange(),t.deleted.forEach(function(t){$(".add-to-basket[data-id="+t+"]").removeClass("disabled").html('Add To Basket <i class="fa fa-shopping-cart font-size-p2"></i>');var e=$order.find("tr[data-id="+t+"]");$items=$items.not(e),e.slideUp(function(){$(this).remove()})}),$items.each(function(e,r){id=r.dataset.id,$row=$(r),$row.find(".iteration").html(e+1),$row.find(".name").html(t.items[id].name);var n=$row.find("select"),d=Object.keys(n[0].selectize.options).length;if(d!=t.items[id].instock_quantity)if(d>=t.items[id].instock_quantity)for(e=t.items[id].instock_quantity+1;e<=d;e++)n[0].selectize.removeOption(e);else for(e=d+1;e<=t.items[id].instock_quantity;e++)n[0].selectize.addOption({value:e,text:e});0==orderItems[id]&&(n[0].selectize.addOption({value:0,text:0}),a=!0),n[0].selectize.setValue(orderItems[id],!0),$row.find(".net-price").html(t.items[id].net_price)}),t.added.forEach(function(e){var r=$("<select>",{name:"quantity","class":"form-control","data-id":e});if(0!=orderItems[e])for(i=1;i<=t.items[e].instock_quantity;i++)r.append('<option value="'+i+'">'+i+"</option>");else r.append('<option value="0">0</option>'),a=!0;r.val(orderItems[e]);var n=$("<td>",{"class":"quantity"}).append(r),d=$("<tr>",{"class":"text-center","data-id":e}).append('<td class="iteration">'+($items.length+1)+"</td>",'<td class="name">'+t.items[e].name+"</td>",n,'<td class="net-price">'+t.items[e].net_price+"</td>",'<td><a class="text-danger delete-item" href="#" data-id="'+e+'"><i class="glyphicon glyphicon-trash"></i></a></td>');r.selectize(),$items=$items.add(d),$order.find("tbody").append(d)}),$total.find(".quantity").html(t.total.quantity),$total.find(".net-price").html(t.total.net_price),Number.parseInt($basketCount.text())!=t.total.quantity&&($basketCount.addClass("ping"),$basketCount.html(t.total.quantity),setTimeout(function(){$basketCount.removeClass("ping")},1e3)),a?updateOrder(e):"function"==typeof e&&e.call(this,t),attachQuantityChange()}var $basket=$(".basket-panel"),$confirmOrder=$basket.find(".confirm-order"),$deleteOrder=$basket.find(".delete-order"),$refreshOrder=$basket.find(".refresh-order"),$clearOrder=$basket.find(".clear-order"),$basketCount=$(".basket .count"),$order=$basket.find(".order"),$items=$order.find("tr[data-id]"),$total=$order.find("tr.total"),$newOrder=$basket.find(".new-order"),$ajaxLoader=$basket.find(".ajax-loader"),$add=$(".add-to-basket");$basket.click(function(t){t.stopPropagation()}),$add.click(function(t){t.preventDefault(),t.stopPropagation(),0!=$order.length&&(Number.parseInt(this.dataset.instock)?(orderItems[this.dataset.id]=1,updateOrder(),$(this).addClass("disabled").text("In Basket")):$(this).addClass("disabled btn-danger"))}),attachBehaviour();